# 条件变量模式（Condition Variable Pattern）

## 概述

条件变量是一种同步原语，它允许一个或多个线程在满足特定条件之前保持等待状态。当其他线程修改了条件并发出通知时，等待的线程可以被唤醒并继续执行。

## 设计意图

条件变量解决的核心问题是：
- 线程需要等待某个条件变为真才能继续执行
- 其他线程可以改变这个条件并通知等待的线程

这种机制比持续轮询状态更加高效，因为线程在条件未满足时可以被挂起，不消耗CPU资源。

## 实现原理

条件变量通常与互斥锁一起使用，实现步骤如下：

1. 获取与条件变量关联的互斥锁
2. 在条件不满足时调用Wait方法，此操作会：
   - 原子性地释放锁
   - 将线程置于等待状态
   - 当被唤醒时，自动重新获取锁
3. 当其他线程想要改变条件时，它需要：
   - 获取相同的互斥锁
   - 修改条件
   - 通过Signal或Broadcast方法通知等待的线程
   - 释放互斥锁

## 代码实现

本实现中，我们创建了一个Data结构体，它使用条件变量来同步对数据就绪状态的访问：
- `Data`结构包含一个ready标志和一个条件变量
- `WaitForReady`方法使线程等待直到数据准备就绪
- `SetReady`方法将数据设为就绪状态并通知等待的线程

## 使用示例

测试代码演示了条件变量的基本用法：一个goroutine等待数据准备好，另一个goroutine设置数据为就绪状态后发出通知。

```go
func TestConditionVariable(t *testing.T) {
	data := NewData()
	var wg sync.WaitGroup
	wg.Add(1)

	go func() {
		defer wg.Done()
		data.WaitForReady()
	}()

	fmt.Println("Preparing data...")
	data.SetReady()

	wg.Wait()
}
```

## 应用场景

- 生产者-消费者模式：消费者等待生产者产生数据
- 线程池：线程等待任务被添加到队列
- 资源就绪通知：等待某资源变为可用状态